<div *ngIf="loading"
  class="absolute w-full h-full flex justify-center items-center z-50 text-base-300 bg-black bg-opacity-50">
  <span class="loading loading-spinner loading-lg"></span>
</div>

<app-navbar />

<div class="w-full h-full flex flex-col justify-center items-center p-4 m-auto max-w-4xl">
  <div class="w-full">
    <form ngNativeValidate [formGroup]="createTaskForm" (ngSubmit)="addTodo()"
      class="grid grid-cols-[5fr_2fr_2fr_1fr] items-end gap-2 my-2">
      <div class="form-control w-full">
        <label for="newTaskText" class="label pb-1">
          <span class="label-text">Task</span>
        </label>
        <input id="newTaskText" formControlName="newTaskText" class="input input-bordered w-full" type="text"
          placeholder="Make coffee" required />
      </div>

      <div class="form-control w-full">
        <label for="estimatedTime" class="label pb-1">
          <span class="label-text">Estimated (hours)</span>
        </label>
        <input id="estimatedTime" formControlName="estimatedTime" class="input input-bordered w-full" type="number"
          min="1" max="9999" placeholder="Estimated Time (hours)" required />
      </div>

      <div class="form-control w-full">
        <label for="taskValue" class="label pb-1">
          <span class="label-text">Task Value</span>
        </label>
        <input id="taskValue" formControlName="taskValue" class="input input-bordered w-full" type="number" min="1"
          max="9999" placeholder="Task Value" required />
      </div>

      <button type="submit" class="btn">
        Add
      </button>
    </form>

    <div *ngIf="errorText" class="rounded-md bg-red-100 p-4 my-3">
      <div class="text-sm leading-5 text-red-700">{{errorText}}</div>
    </div>

    <ul class="join join-vertical w-full shadow overflow-hidden rounded-md">
      <li *ngFor="let todo of todos" class="collapse collapse-arrow join-item border border-base-300">
        <input type="radio" name="accordionTask" />
        <div
          class="collapse-title text-sm font-medium grid grid-cols-[0.65fr_0.35fr] justify-between items-center gap-4">
          <p class="truncate flex-shrink">{{todo.task}}</p>
          <div class="flex flex-row justify-between gap-4">
            <p>Est.(h): {{todo.estimated_time}}</p>
            <p>Value: {{todo.task_value}}</p>
          </div>
        </div>
        <div class="collapse-content flex justify-between items-center gap-4">
          <p>{{todo.task}}</p>
          <div>
            <input class="cursor-pointer" type="checkbox" (change)="toggleCompleted(todo.id, todo.is_complete)"
              (ng-model)="todo.is_complete" />
          </div>
          <button (click)="deleteTodo(todo.id)">
            <ion-icon name="close-outline" class="w-4 h-4 border-2 hover:border-black rounded" />
          </button>
        </div>
      </li>
    </ul>
  </div>
</div>